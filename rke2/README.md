# RKE2 é›†ç¾¤è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·

ä¸€ä¸ªç®€æ´é«˜æ•ˆçš„ RKE2 Kubernetes é›†ç¾¤è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼Œä½¿ç”¨ Ruby å®ç°ï¼Œä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½å’Œç¨³å®šæ€§ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- ğŸš€ **è‡ªåŠ¨åŒ–éƒ¨ç½²**: ä¸€é”®éƒ¨ç½²å®Œæ•´çš„ RKE2 é«˜å¯ç”¨é›†ç¾¤
- ğŸ”§ **å¤šèŠ‚ç‚¹ç±»å‹**: æ”¯æŒä¸»èŠ‚ç‚¹ã€å·¥ä½œèŠ‚ç‚¹å’Œè´Ÿè½½å‡è¡¡èŠ‚ç‚¹
- âš¡ **æ€§èƒ½ä¼˜åŒ–**: è‡ªåŠ¨è¿›è¡ŒèŠ‚ç‚¹åˆå§‹åŒ–å’Œç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–
- ğŸ”’ **TLS å®‰å…¨**: è‡ªåŠ¨é…ç½®å’Œç®¡ç† TLS è¯ä¹¦
- ğŸŒ **Ingress DaemonSet**: è‡ªåŠ¨éƒ¨ç½² Nginx Ingress Controller ä¸º DaemonSet æ¨¡å¼
- ğŸ¯ **è‡ªåŠ¨å·¥å…·**: è‡ªåŠ¨é…ç½® kubectlã€k9sã€helm ç­‰ç®¡ç†å·¥å…·
- ğŸ“Š **çŠ¶æ€ç›‘æ§**: å®æ—¶ç›‘æ§é›†ç¾¤éƒ¨ç½²çŠ¶æ€å’Œå¥åº·æ£€æŸ¥
- ğŸ› ï¸ **æ•…éšœè¯Šæ–­**: å†…ç½®é›†ç¾¤çŠ¶æ€è¯Šæ–­å’Œé—®é¢˜æ’æŸ¥å·¥å…·
- âš¡ **è½»é‡çº§**: ç²¾ç®€çš„ä¾èµ–ï¼Œå¿«é€Ÿå®‰è£…å’Œéƒ¨ç½²

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linuxï¼ˆæ¨è Ubuntu 20.04+ æˆ– CentOS 8+ï¼‰
- **ç¡¬ä»¶è¦æ±‚**: æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘ 2 CPUï¼Œ4GB å†…å­˜ï¼Œ20GB ç£ç›˜ç©ºé—´
- **ç½‘ç»œè¦æ±‚**: èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œäº’é€šï¼Œæ”¯æŒ SSH è®¿é—®
- **æƒé™è¦æ±‚**: å…·æœ‰ sudo æˆ– root æƒé™
- **Ruby ç‰ˆæœ¬**: Ruby 3.0+

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <repository_url>
cd rke2

# è¿è¡Œç¯å¢ƒå®‰è£…è„šæœ¬
./setup.sh
```

å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- å®‰è£… Ruby ç¯å¢ƒå’Œä¾èµ–ç®¡ç†å·¥å…·
- å®‰è£…é¡¹ç›®ä¾èµ–
- è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™

### 2. é…ç½®é›†ç¾¤

ç¼–è¾‘ `config.yml` æ–‡ä»¶ï¼š

```yaml
# é›†ç¾¤è®¤è¯ä»¤ç‰Œ
token: rke2Secret123456

# è´Ÿè½½å‡è¡¡å™¨IPï¼ˆç”¨äºé«˜å¯ç”¨é›†ç¾¤ï¼‰
loadbalancer_ip: 10.0.1.100

# èŠ‚ç‚¹é…ç½®
nodes:
  # ä¸»èŠ‚ç‚¹ï¼ˆæ§åˆ¶å¹³é¢ï¼‰
  - name: master-01
    ip: 10.0.1.10
    role: server
    ssh_user: root

  # å·¥ä½œèŠ‚ç‚¹
  - name: worker-01
    ip: 10.0.1.20
    role: agent
    ssh_user: root

  # è´Ÿè½½å‡è¡¡èŠ‚ç‚¹ï¼ˆå¯é€‰ï¼‰
  - name: lb-01
    ip: 10.0.1.100
    role: lb
    ssh_user: root
```

### 3. éƒ¨ç½²é›†ç¾¤

```bash
# å¼€å§‹éƒ¨ç½²
ruby run.rb

# æˆ–ä½¿ç”¨ Rake ä»»åŠ¡
bundle exec rake rke2:deploy
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤

```bash
# éƒ¨ç½²å®Œæ•´é›†ç¾¤
ruby run.rb

# è¯Šæ–­é›†ç¾¤çŠ¶æ€
bundle exec rake rke2:diagnose

# åˆå§‹åŒ–å’Œä¼˜åŒ–æ‰€æœ‰èŠ‚ç‚¹
bundle exec rake rke2:init_nodes

# åˆå§‹åŒ–å’Œä¼˜åŒ–ç‰¹å®šèŠ‚ç‚¹
bundle exec rake rke2:init_node[master-01]

# é…ç½®æ‰€æœ‰ä¸»èŠ‚ç‚¹çš„ kubectl
bundle exec rake rke2:configure_kubectl

# é…ç½®ç‰¹å®šä¸»èŠ‚ç‚¹çš„ kubectl
bundle exec rake rke2:configure_kubectl_node[master-01]

# å®‰è£… k9s å’Œ helm åˆ°æ‰€æœ‰ä¸»èŠ‚ç‚¹
bundle exec rake rke2:install_k9s_helm

# å®‰è£… k9s å’Œ helm åˆ°ç‰¹å®šä¸»èŠ‚ç‚¹
bundle exec rake rke2:install_k9s_helm_node[master-01]

# é…ç½® Ingress Controller ä¸º DaemonSet æ¨¡å¼
bundle exec rake rke2:configure_ingress_daemonset

# ä¿®å¤ Ingress Controller RBAC æƒé™
bundle exec rake rke2:fix_ingress_rbac

# ä»£ç è´¨é‡æ£€æŸ¥
bundle exec rake test:lint

# ç”Ÿæˆæ–‡æ¡£
bundle exec rake doc:yard
```

### é›†ç¾¤ç®¡ç†

#### è‡ªåŠ¨ kubectl é…ç½®ï¼ˆæ¨èï¼‰

æœ¬å·¥å…·ä¼šè‡ªåŠ¨ä¸ºä¸»èŠ‚ç‚¹é…ç½® kubectlï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®ï¼š

```bash
# é…ç½®æ‰€æœ‰ä¸»èŠ‚ç‚¹çš„ kubectlï¼ˆéƒ¨ç½²æ—¶è‡ªåŠ¨æ‰§è¡Œï¼‰
bundle exec rake rke2:configure_kubectl

# é…ç½®ç‰¹å®šä¸»èŠ‚ç‚¹
bundle exec rake rke2:configure_kubectl_node[master-01]
```

é…ç½®å®Œæˆåï¼Œç›´æ¥ç™»å½•ä¸»èŠ‚ç‚¹å³å¯ä½¿ç”¨æ‰€æœ‰å·¥å…·ï¼š

```bash
# SSH åˆ°ä¸»èŠ‚ç‚¹
ssh root@<master-node-ip>

# ç›´æ¥ä½¿ç”¨ kubectlï¼ˆæ— éœ€é¢å¤–é…ç½®ï¼‰
kubectl get nodes
kubectl cluster-info
k get pods --all-namespaces  # k æ˜¯ kubectl çš„åˆ«å

# ä½¿ç”¨ k9s ç»ˆç«¯ UI ç®¡ç†é›†ç¾¤
k9s

# ä½¿ç”¨ helm åŒ…ç®¡ç†å™¨
helm list
helm repo list
```

#### æ‰‹åŠ¨ kubectl é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœæ‚¨éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼š

```bash
# SSH åˆ°ä¸»èŠ‚ç‚¹
ssh root@<master-node-ip>

# ä½¿ç”¨å®Œæ•´è·¯å¾„
export KUBECONFIG=/etc/rancher/rke2/rke2.yaml
/var/lib/rancher/rke2/bin/kubectl get nodes
```

### Ingress Controller DaemonSet æ¨¡å¼

æœ¬å·¥å…·è‡ªåŠ¨å°† Nginx Ingress Controller é…ç½®ä¸º DaemonSet æ¨¡å¼ï¼Œæä¾›ä»¥ä¸‹ä¼˜åŠ¿ï¼š

#### DaemonSet æ¨¡å¼çš„ä¼˜åŠ¿
- **é«˜å¯ç”¨æ€§**: åœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œ Ingress å®ä¾‹
- **è´Ÿè½½åˆ†æ•£**: æµé‡ç›´æ¥åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œæ— éœ€é¢å¤–çš„è´Ÿè½½å‡è¡¡
- **æœ€ä½³æ€§èƒ½**: ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œå‡å°‘ç½‘ç»œå±‚æ¬¡ï¼Œæé«˜æ€§èƒ½
- **æ•…éšœéš”ç¦»**: å•ä¸ªèŠ‚ç‚¹æ•…éšœä¸å½±å“å…¶ä»–èŠ‚ç‚¹çš„ Ingress æœåŠ¡

#### è‡ªåŠ¨é…ç½®åŠŸèƒ½
- **å®¿ä¸»æœºç½‘ç»œ**: ç›´æ¥ä½¿ç”¨èŠ‚ç‚¹çš„ç½‘ç»œï¼Œç«¯å£ 80 å’Œ 443 ç›´æ¥æš´éœ²
- **èŠ‚ç‚¹é€‰æ‹©å™¨**: åªåœ¨ Linux èŠ‚ç‚¹ä¸Šéƒ¨ç½²
- **æ±¡ç‚¹å®¹å¿**: æ”¯æŒåœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿è¡Œï¼ˆå¦‚æœéœ€è¦ï¼‰
- **SSL ç›´é€š**: æ”¯æŒ SSL passthrough åŠŸèƒ½
- **å®æ—¶ IP**: è‡ªåŠ¨æ£€æµ‹å’ŒæŠ¥å‘ŠçœŸå®å®¢æˆ·ç«¯ IP

#### éªŒè¯ Ingress éƒ¨ç½²

```bash
# SSH åˆ°ä¸»èŠ‚ç‚¹
ssh root@<master-node-ip>

# æ£€æŸ¥ Ingress DaemonSet çŠ¶æ€
kubectl -n ingress-nginx get daemonset
kubectl -n ingress-nginx get pods -o wide

# æ£€æŸ¥ Ingress ç«¯å£
ss -tlnp | grep -E ':80|:443'

# æµ‹è¯• Ingress å¥åº·æ£€æŸ¥
curl -I http://localhost/healthz
```

#### æ‰‹åŠ¨é…ç½® Ingress DaemonSet

å¦‚æœéœ€è¦å•ç‹¬é…ç½® Ingress Controllerï¼š

```bash
# é…ç½® Ingress Controller ä¸º DaemonSet æ¨¡å¼
bundle exec rake rke2:configure_ingress_daemonset

# å¦‚æœé‡åˆ° RBAC æƒé™é—®é¢˜ï¼Œè¿è¡Œä¿®å¤å‘½ä»¤
bundle exec rake rke2:fix_ingress_rbac
```

#### æ•…éšœæ’é™¤ - RBAC æƒé™é—®é¢˜

å¦‚æœæ‚¨çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„é”™è¯¯ï¼š
```
pods "nginx-ingress-controller-xxxx" is forbidden: User "system:serviceaccount:ingress-nginx:nginx-ingress-serviceaccount" cannot get resource "pods"
```

è¿è¡Œ RBAC æƒé™ä¿®å¤å‘½ä»¤ï¼š
```bash
bundle exec rake rke2:fix_ingress_rbac
```

è¯¥å‘½ä»¤ä¼šï¼š
- æ›´æ–° ClusterRole å’Œ Role æƒé™
- é‡å¯ Ingress Controller Pods
- éªŒè¯æƒé™ä¿®å¤çŠ¶æ€

## ğŸ“ é¡¹ç›®ç»“æ„

```
rke2/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ rke2_deploy.rb         # æ ¸å¿ƒéƒ¨ç½²é€»è¾‘
â”œâ”€â”€ output/                    # ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å’Œè„šæœ¬
â”‚   â”œâ”€â”€ master-01/
â”‚   â”‚   â”œâ”€â”€ config.yaml       # RKE2 é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ install.sh        # å®‰è£…è„šæœ¬
â”‚   â””â”€â”€ lb-01/
â”‚       â”œâ”€â”€ haproxy.cfg       # HAProxy é…ç½®
â”‚       â””â”€â”€ install.sh        # è´Ÿè½½å‡è¡¡å™¨å®‰è£…è„šæœ¬
â”œâ”€â”€ config.yml                # é›†ç¾¤é…ç½®æ–‡ä»¶
â”œâ”€â”€ run.rb                    # ä¸»æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ setup.sh                 # ç¯å¢ƒå®‰è£…è„šæœ¬
â”œâ”€â”€ Gemfile                   # ä¾èµ–ç®¡ç†ï¼ˆå·²ä¼˜åŒ–ï¼‰
â”œâ”€â”€ Rakefile                  # ä»»åŠ¡å®šä¹‰
â”œâ”€â”€ .rubocop.yml             # ä»£ç é£æ ¼é…ç½®
â””â”€â”€ README.md                # æœ¬æ–‡æ¡£
```

## ğŸ”§ ä¾èµ–è¯´æ˜

é¡¹ç›®ç»è¿‡ä¼˜åŒ–ï¼ŒåªåŒ…å«å¿…è¦çš„ä¾èµ–ï¼š

### æ ¸å¿ƒä¾èµ–
- `net-ssh`: SSH è¿æ¥ç®¡ç†
- `net-scp`: æ–‡ä»¶ä¼ è¾“
- `logger`: æ—¥å¿—è®°å½•
- `fileutils`: æ–‡ä»¶æ“ä½œ
- `rake`: ä»»åŠ¡ç®¡ç†

### å¼€å‘ä¾èµ–
- `rspec`: æµ‹è¯•æ¡†æ¶
- `rubocop`: ä»£ç è´¨é‡æ£€æŸ¥
- `yard`: æ–‡æ¡£ç”Ÿæˆ
- `pry`: è°ƒè¯•å·¥å…·

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. TLS è¯ä¹¦éªŒè¯å¤±è´¥
```
Error: tls: failed to verify certificate
```

**è§£å†³æ–¹æ¡ˆ**: è¿™ä¸ªé—®é¢˜å·²åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ä¿®å¤ã€‚ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ­£ç¡®çš„ `tls-san` è®¾ç½®ã€‚

#### 2. SSH è¿æ¥å¤±è´¥
```
Error: Net::SSH::AuthenticationFailed
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ SSH å¯†é’¥é…ç½®
- ç¡®è®¤ç”¨æˆ·åå’Œæƒé™
- éªŒè¯ç½‘ç»œè¿é€šæ€§

#### 3. èŠ‚ç‚¹æœªå°±ç»ª
```
Node status: NotReady
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# è¿è¡Œè¯Šæ–­å·¥å…·
bundle exec rake rke2:diagnose

# æ£€æŸ¥ç‰¹å®šèŠ‚ç‚¹çš„æ—¥å¿—
ssh root@<node-ip>
journalctl -u rke2-server -f
```

### è¯Šæ–­å‘½ä»¤

```bash
# æ£€æŸ¥é›†ç¾¤çŠ¶æ€
bundle exec rake rke2:diagnose

# æ£€æŸ¥è¯­æ³•
ruby -c lib/rke2_deploy.rb
ruby -c run.rb

# è¿è¡Œä»£ç æ£€æŸ¥
bundle exec rubocop
```

### æ—¥å¿—ä½ç½®

- **éƒ¨ç½²æ—¥å¿—**: `deploy.log`
- **RKE2 æœåŠ¡å™¨æ—¥å¿—**: `/var/log/rke2/rke2.log`ï¼ˆåœ¨å„èŠ‚ç‚¹ä¸Šï¼‰
- **ç³»ç»Ÿæ—¥å¿—**: `journalctl -u rke2-server`

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### éƒ¨ç½²æµç¨‹

1. **è´Ÿè½½å‡è¡¡å™¨éƒ¨ç½²**: é…ç½® HAProxy ä¸º API æœåŠ¡å™¨æä¾›é«˜å¯ç”¨
2. **ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹**: åˆå§‹åŒ–é›†ç¾¤æ§åˆ¶å¹³é¢
3. **å…¶ä»–ä¸»èŠ‚ç‚¹**: åŠ å…¥é›†ç¾¤å½¢æˆé«˜å¯ç”¨æ§åˆ¶å¹³é¢
4. **å·¥ä½œèŠ‚ç‚¹**: åŠ å…¥é›†ç¾¤æä¾›è®¡ç®—èµ„æº

### ç½‘ç»œé…ç½®

- **API æœåŠ¡å™¨**: ç«¯å£ 6443ï¼ˆé€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼‰
- **RKE2 æ³¨å†Œ**: ç«¯å£ 9345
- **CNI**: ä½¿ç”¨ Canalï¼ˆCalico + Flannelï¼‰
- **æœåŠ¡ç½‘ç»œ**: 10.43.0.0/16
- **Pod ç½‘ç»œ**: 10.42.0.0/16

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œä»£ç æ£€æŸ¥
bundle exec rake test:lint

# è¯­æ³•æ£€æŸ¥
bundle exec rake -T  # åˆ—å‡ºæ‰€æœ‰å¯ç”¨ä»»åŠ¡
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. **Fork é¡¹ç›®**
2. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**: `git checkout -b feature/amazing-feature`
3. **æäº¤æ›´æ”¹**: `git commit -m 'Add amazing feature'`
4. **æ¨é€åˆ†æ”¯**: `git push origin feature/amazing-feature`
5. **åˆ›å»º Pull Request**

### ä»£ç é£æ ¼

é¡¹ç›®ä½¿ç”¨ RuboCop è¿›è¡Œä»£ç é£æ ¼æ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥ä»£ç é£æ ¼
bundle exec rubocop

# è‡ªåŠ¨ä¿®å¤å¯ä¿®å¤çš„é—®é¢˜
bundle exec rubocop -A
```

### èŠ‚ç‚¹åˆå§‹åŒ–å’Œæ€§èƒ½ä¼˜åŒ–

åœ¨éƒ¨ç½² RKE2 ä¹‹å‰ï¼Œå·¥å…·ä¼šè‡ªåŠ¨å¯¹æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œç³»ç»Ÿä¼˜åŒ–ï¼š

#### ç³»ç»Ÿä¼˜åŒ–é¡¹ç›®
1. **æ—¶é—´åŒæ­¥**: è‡ªåŠ¨å®‰è£…å’Œé…ç½® chrony/ntp æœåŠ¡
2. **å†…å­˜ç®¡ç†**: ç¦ç”¨ swapï¼Œé…ç½®å†…å­˜å›æ”¶ç­–ç•¥
3. **å†…æ ¸ä¼˜åŒ–**: åŠ è½½å¿…è¦æ¨¡å— (overlay, br_netfilter, ip_vs ç­‰)
4. **ç½‘ç»œå‚æ•°**: ä¼˜åŒ– TCP/IP æ ˆå’Œè¿æ¥è·Ÿè¸ª
5. **ç³»ç»Ÿé™åˆ¶**: è°ƒæ•´æ–‡ä»¶å¥æŸ„å’Œè¿›ç¨‹æ•°é™åˆ¶
6. **é˜²ç«å¢™**: ç¦ç”¨å†²çªçš„é˜²ç«å¢™æœåŠ¡
7. **ç£ç›˜æ€§èƒ½**: ä¼˜åŒ–ç£ç›˜è°ƒåº¦å™¨è®¾ç½®
8. **DNS é…ç½®**: é…ç½®é«˜æ€§èƒ½ DNS æœåŠ¡å™¨
9. **å®‰å…¨è®¾ç½®**: åº”ç”¨å®‰å…¨ç›¸å…³çš„å†…æ ¸å‚æ•°
10. **ç³»ç»Ÿå·¥å…·**: å®‰è£…å¿…è¦çš„ç®¡ç†å’Œç›‘æ§å·¥å…·

#### æ€§èƒ½ä¼˜åŒ–å‚æ•°
- ç½‘ç»œè¿æ¥è·Ÿè¸ªæœ€å¤§å€¼: 1,000,000
- æ–‡ä»¶å¥æŸ„é™åˆ¶: 1,048,576
- TCP ç¼“å†²åŒºä¼˜åŒ–: æœ€å¤§ 16MB
- ç¦ç”¨é€æ˜å¤§é¡µ (THP)
- è®¾ç½®åˆç†çš„å†…æ ¸ panic å‚æ•°

### ç®¡ç†å·¥å…·è‡ªåŠ¨é…ç½®è¯´æ˜

æœ¬å·¥å…·è‡ªåŠ¨ä¸ºä¸»èŠ‚ç‚¹é…ç½®ä»¥ä¸‹ç®¡ç†å·¥å…·ï¼š

#### kubectl é…ç½®
1. **kubectl è½¯é“¾æ¥**: `/usr/local/bin/kubectl` -> `/var/lib/rancher/rke2/bin/kubectl`
2. **Kubeconfig æ–‡ä»¶**: å¤åˆ¶åˆ° `/root/.kube/config`
3. **ç¯å¢ƒå˜é‡**: è‡ªåŠ¨æ·»åŠ åˆ° `/root/.bashrc` å’Œ `/root/.profile`
   - `KUBECONFIG=/root/.kube/config`
   - `PATH=/var/lib/rancher/rke2/bin:$PATH`
4. **å‘½ä»¤åˆ«å**: `k=kubectl` (æ–¹ä¾¿å¿«é€Ÿä½¿ç”¨)
5. **æƒé™è®¾ç½®**: ç¡®ä¿æ–‡ä»¶å…·æœ‰æ­£ç¡®çš„æƒé™ (600)

#### k9s é…ç½®
1. **è‡ªåŠ¨ä¸‹è½½**: æœ€æ–°ç‰ˆæœ¬çš„ k9s äºŒè¿›åˆ¶æ–‡ä»¶
2. **å®‰è£…ä½ç½®**: `/usr/local/bin/k9s`
3. **é…ç½®æ–‡ä»¶**: è‡ªåŠ¨åˆ›å»º `/root/.config/k9s/config.yml`
4. **ä¼˜åŒ–è®¾ç½®**: é…ç½®åˆç†çš„åˆ·æ–°é¢‘ç‡å’Œ UI é€‰é¡¹

#### helm é…ç½®
1. **å®˜æ–¹å®‰è£…**: ä½¿ç”¨ helm å®˜æ–¹å®‰è£…è„šæœ¬
2. **å®‰è£…ä½ç½®**: `/usr/local/bin/helm`
3. **ä»“åº“åˆå§‹åŒ–**: è‡ªåŠ¨æ·»åŠ  stable å’Œ bitnami ä»“åº“
4. **ç‰ˆæœ¬æ”¯æŒ**: å®‰è£…æœ€æ–°çš„ helm v3

é…ç½®å®Œæˆåï¼Œroot ç”¨æˆ·ç™»å½•å³å¯ç›´æ¥ä½¿ç”¨ï¼š
- `kubectl get nodes` / `k get nodes`
- `k9s` (ç»ˆç«¯ UI é›†ç¾¤ç®¡ç†)
- `helm list` (åŒ…ç®¡ç†å™¨)
- `kubectl cluster-info`

## ğŸ“ ç‰ˆæœ¬å†å²

### v2.3.0 (æœ€æ–°)
- âš¡ **æ–°å¢**: è‡ªåŠ¨èŠ‚ç‚¹åˆå§‹åŒ–å’Œæ€§èƒ½ä¼˜åŒ–åŠŸèƒ½
- ğŸ”§ ç³»ç»Ÿå‚æ•°è‡ªåŠ¨ä¼˜åŒ– (å†…æ ¸ã€ç½‘ç»œã€å†…å­˜ç­‰)
- ğŸ› ï¸ è‡ªåŠ¨å®‰è£…ç³»ç»Ÿå·¥å…·å’Œä¾èµ–
- ğŸ·ï¸ è‡ªåŠ¨è®¾ç½®ä¸»æœºåå’Œ DNS ä¼˜åŒ–
- ğŸ’¾ å†…å­˜å’Œç£ç›˜æ€§èƒ½ä¼˜åŒ–
- ğŸ”¥ é˜²ç«å¢™å’Œå®‰å…¨é…ç½®ä¼˜åŒ–

### v2.2.0
- ğŸ¯ **æ–°å¢**: k9s å’Œ helm è‡ªåŠ¨å®‰è£…åŠŸèƒ½
- ğŸ–¥ï¸ è‡ªåŠ¨å®‰è£… k9s ç»ˆç«¯ UI ç®¡ç†å·¥å…·
- ğŸ“¦ è‡ªåŠ¨å®‰è£… helm åŒ…ç®¡ç†å™¨å¹¶åˆå§‹åŒ–ä»“åº“
- ğŸ”§ ä¼˜åŒ– k9s é…ç½®æ–‡ä»¶å’Œç”¨æˆ·ä½“éªŒ

### v2.1.0
- ğŸ¯ **æ–°å¢**: è‡ªåŠ¨ kubectl é…ç½®åŠŸèƒ½
- ğŸ”— è‡ªåŠ¨åˆ›å»º kubectl è½¯é“¾æ¥å’Œç¯å¢ƒå˜é‡
- ğŸ“ ä¸º root ç”¨æˆ·é…ç½® kubeconfig æ–‡ä»¶
- âš¡ ç®€åŒ–é›†ç¾¤ç®¡ç†æ“ä½œ

### v2.0.0
- âœ¨ é‡æ„æ ¸å¿ƒéƒ¨ç½²é€»è¾‘
- ğŸ”§ ä¿®å¤ TLS è¯ä¹¦éªŒè¯é—®é¢˜
- âš¡ ä¼˜åŒ–ä¾èµ–ç®¡ç†ï¼Œç§»é™¤ 90% æœªä½¿ç”¨çš„ gem
- ğŸ“Š æ”¹è¿›é›†ç¾¤çŠ¶æ€æ£€æŸ¥å’Œè¯Šæ–­
- ğŸ› ï¸ ç®€åŒ– Rakefile å’Œé¡¹ç›®ç»“æ„

### v1.x
- åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«åŸºç¡€éƒ¨ç½²åŠŸèƒ½

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [RKE2 å®˜æ–¹æ–‡æ¡£](https://docs.rke2.io/)
- [Kubernetes å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)
- [HAProxy æ–‡æ¡£](https://www.haproxy.org/download/2.4/doc/configuration.txt)

## ğŸ‰ æœ€æ–°æ›´æ–°

### v2.0 - Ingress DaemonSet æ¨¡å¼

**æ–°å¢åŠŸèƒ½:**
- âœ… **è‡ªåŠ¨ Ingress DaemonSet éƒ¨ç½²**: é»˜è®¤åœ¨é›†ç¾¤éƒ¨ç½²æ—¶è‡ªåŠ¨é…ç½®
- âœ… **ä¼˜åŒ–æ—¶é—´åŒæ­¥æœåŠ¡**: ä¿®å¤ chronyd.service åˆ«åé—®é¢˜ï¼Œæ”¯æŒå¤šç§æ—¶é—´åŒæ­¥æœåŠ¡
- âœ… **ç§»é™¤å†…ç½® RKE2 Ingress**: ä¸å†ç¦ç”¨ RKE2 å†…ç½® Ingressï¼Œæ”¹ä¸ºéƒ¨ç½²ä¼˜åŒ–çš„ DaemonSet ç‰ˆæœ¬
- âœ… **å®¿ä¸»æœºç½‘ç»œæ¨¡å¼**: ä½¿ç”¨ hostNetwork è·å¾—æœ€ä½³ç½‘ç»œæ€§èƒ½
- âœ… **å®Œæ•´ RBAC æƒé™**: é…ç½®å®Œæ•´çš„ ClusterRole å’Œæƒé™ç®¡ç†

**æ€§èƒ½ä¼˜åŒ–:**
- ğŸš€ åœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹è¿è¡Œ Ingress Controller
- ğŸš€ ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œå‡å°‘ç½‘ç»œè·³è½¬
- ğŸš€ æ”¯æŒ SSL passthrough å’ŒçœŸå® IP æ£€æµ‹
- ğŸš€ è‡ªåŠ¨è´Ÿè½½åˆ†æ•£ï¼Œæ— éœ€é¢å¤–è´Ÿè½½å‡è¡¡å™¨

**ä½¿ç”¨æ–¹æ³•:**
```bash
# å®Œæ•´é›†ç¾¤éƒ¨ç½²ï¼ˆåŒ…å« Ingress DaemonSetï¼‰
bundle exec rake rke2:deploy

# å•ç‹¬é…ç½® Ingress DaemonSet
bundle exec rake rke2:configure_ingress_daemonset
```

**éªŒè¯éƒ¨ç½²:**
```bash
# æ£€æŸ¥ DaemonSet çŠ¶æ€
kubectl -n ingress-nginx get daemonset,pods -o wide

# æ£€æŸ¥ç½‘ç»œç«¯å£
ss -tlnp | grep -E ':80|:443'
```

---

**å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestï¼** ğŸš€